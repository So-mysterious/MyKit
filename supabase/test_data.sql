-- ============================================================================
-- MyKit 测试数据 - 流水系统测试用例
-- 说明：包含各类流水、关联交易、跨多天交易、含地点等情况
-- 使用前请确保系统账户和基础费用/收入账户已存在
-- ============================================================================

-- 首先创建一些测试用的真实账户（如果不存在）
-- 注：资产根账户 ID: 00000000-0000-0000-0000-000000000001
-- 注：负债根账户 ID: 00000000-0000-0000-0000-000000000002

-- 测试账户
INSERT INTO accounts (id, parent_id, name, account_class, type, is_group, currency, full_path, sort_order)
VALUES 
  -- 银行账户分组
  ('11111111-1111-1111-1111-111111111001', '00000000-0000-0000-0000-000000000001', '银行账户', 'real', 'asset', true, NULL, '资产:银行账户', 1),
  -- 银行账户-真实账户
  ('11111111-1111-1111-1111-111111111101', '11111111-1111-1111-1111-111111111001', '招商银行储蓄卡', 'real', 'asset', false, 'CNY', '资产:银行账户:招商银行储蓄卡', 1),
  ('11111111-1111-1111-1111-111111111102', '11111111-1111-1111-1111-111111111001', '工商银行工资卡', 'real', 'asset', false, 'CNY', '资产:银行账户:工商银行工资卡', 2),
  -- 现金钱包
  ('11111111-1111-1111-1111-111111111103', '00000000-0000-0000-0000-000000000001', '现金', 'real', 'asset', false, 'CNY', '资产:现金', 10),
  -- 港币账户
  ('11111111-1111-1111-1111-111111111104', '11111111-1111-1111-1111-111111111001', '八达通', 'real', 'asset', false, 'HKD', '资产:银行账户:八达通', 3),
  -- 信用卡
  ('11111111-1111-1111-1111-111111111201', '00000000-0000-0000-0000-000000000002', '招商银行信用卡', 'real', 'liability', false, 'CNY', '负债:招商银行信用卡', 1)
ON CONFLICT (id) DO NOTHING;

-- 获取费用账户ID（使用视图或假设已存在）
-- 注意：这些账户应该在系统初始化时已创建

-- ============================================================================
-- 期初余额交易
-- ============================================================================
INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, from_amount, to_amount, description, is_opening, nature)
VALUES
  -- 招商银行储蓄卡期初余额 50000
  ('aaaaaaaa-0001-0001-0001-000000000001', '2025-12-01 00:00:00+08', '00000000-0000-0000-0000-000000000006', '11111111-1111-1111-1111-111111111101', 50000, 50000, 50000, '期初余额', true, 'regular'),
  -- 工商银行工资卡期初余额 12000
  ('aaaaaaaa-0001-0001-0001-000000000002', '2025-12-01 00:00:00+08', '00000000-0000-0000-0000-000000000006', '11111111-1111-1111-1111-111111111102', 12000, 12000, 12000, '期初余额', true, 'regular'),
  -- 现金期初 500
  ('aaaaaaaa-0001-0001-0001-000000000003', '2025-12-01 00:00:00+08', '00000000-0000-0000-0000-000000000006', '11111111-1111-1111-1111-111111111103', 500, 500, 500, '期初余额', true, 'regular'),
  -- 八达通期初 HKD 200
  ('aaaaaaaa-0001-0001-0001-000000000004', '2025-12-01 00:00:00+08', '00000000-0000-0000-0000-000000000006', '11111111-1111-1111-1111-111111111104', 200, 200, 200, '期初余额', true, 'regular'),
  -- 信用卡欠款 -3000（负债类期初为负）
  ('aaaaaaaa-0001-0001-0001-000000000005', '2025-12-01 00:00:00+08', '00000000-0000-0000-0000-000000000006', '11111111-1111-1111-1111-111111111201', 3000, 3000, 3000, '期初欠款', true, 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 2025年12月 收入交易
-- ============================================================================
-- 查询收入账户：SELECT id, name FROM accounts WHERE type = 'income' AND is_group = false;
-- 假设工资账户存在

INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, description, location, is_starred, nature)
VALUES
  -- 12月5日 发工资
  ('bbbbbbbb-0001-0001-0001-000000000001', '2025-12-05 10:00:00+08', 
   (SELECT id FROM accounts WHERE name = '工资' AND type = 'income' LIMIT 1),
   '11111111-1111-1111-1111-111111111102', 
   25000, '12月份工资', NULL, true, 'regular'),
  
  -- 12月10日 年终奖
  ('bbbbbbbb-0001-0001-0001-000000000002', '2025-12-10 14:30:00+08',
   (SELECT id FROM accounts WHERE name = '奖金' AND type = 'income' LIMIT 1),
   '11111111-1111-1111-1111-111111111102',
   50000, '年终奖金', NULL, true, 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 2025年12月 支出交易（各种类型）
-- ============================================================================

INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, description, location, is_large_expense, is_starred, needs_review, nature)
VALUES
  -- 12月6日 普通餐饮支出
  ('cccccccc-0001-0001-0001-000000000001', '2025-12-06 12:30:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   35, '午餐-黄焖鸡米饭', '望京SOHO', false, false, false, 'regular'),
  
  -- 12月6日 咖啡（同一天多笔）
  ('cccccccc-0001-0001-0001-000000000002', '2025-12-06 15:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   42, '下午茶-星巴克拿铁', '星巴克 国贸店', false, false, false, 'regular'),
  
  -- 12月7日 大额支出（购物）
  ('cccccccc-0001-0001-0001-000000000003', '2025-12-07 16:00:00+08',
   '11111111-1111-1111-1111-111111111201',  -- 信用卡支付
   (SELECT id FROM accounts WHERE name = '购物' AND type = 'expense' LIMIT 1),
   3999, 'AirPods Pro 2', '苹果官方旗舰店', true, true, false, 'unexpected'),
  
  -- 12月8日 交通
  ('cccccccc-0001-0001-0001-000000000004', '2025-12-08 08:30:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '交通' AND type = 'expense' LIMIT 1),
   25, '滴滴打车上班', NULL, false, false, false, 'regular'),
  
  -- 12月8日 待核对支出
  ('cccccccc-0001-0001-0001-000000000005', '2025-12-08 20:00:00+08',
   '11111111-1111-1111-1111-111111111103',  -- 现金
   (SELECT id FROM accounts WHERE name = '娱乐' AND type = 'expense' LIMIT 1),
   150, '和朋友吃饭AA', '簋街某饭店', false, false, true, 'regular'),
  
  -- 12月10日 周期性支出
  ('cccccccc-0001-0001-0001-000000000006', '2025-12-10 00:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '居住' AND type = 'expense' LIMIT 1),
   5500, '12月房租', NULL, true, false, false, 'periodic'),
  
  -- 12月12日 意外支出
  ('cccccccc-0001-0001-0001-000000000007', '2025-12-12 11:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '医疗' AND type = 'expense' LIMIT 1),
   280, '感冒药+挂号费', '北京协和医院', false, true, false, 'unexpected'),
   
  -- 12月15日 通讯
  ('cccccccc-0001-0001-0001-000000000008', '2025-12-15 10:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '通讯' AND type = 'expense' LIMIT 1),
   128, '12月手机话费', NULL, false, false, false, 'periodic'),

  -- 12月16日 多笔小额（测试同日多笔）
  ('cccccccc-0001-0001-0001-000000000009', '2026-01-16 08:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '交通' AND type = 'expense' LIMIT 1),
   2, '地铁', NULL, false, false, false, 'regular'),
  
  ('cccccccc-0001-0001-0001-000000000010', '2026-01-16 12:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   28, '午餐-沙县小吃', '公司楼下', false, false, false, 'regular'),
  
  ('cccccccc-0001-0001-0001-000000000011', '2026-01-16 14:00:00+08',
   '11111111-1111-1111-1111-111111111103',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   15, '奶茶-喜茶', '三里屯', false, false, false, 'regular'),
  
  ('cccccccc-0001-0001-0001-000000000012', '2026-01-16 18:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '交通' AND type = 'expense' LIMIT 1),
   2, '地铁下班', NULL, false, false, false, 'regular'),
  
  ('cccccccc-0001-0001-0001-000000000013', '2026-01-16 19:30:00+08',
   '11111111-1111-1111-1111-111111111201',  -- 信用卡
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   198, '晚餐-海底捞', '海底捞 朝阳大悦城店', false, false, false, 'regular'),

  -- 1月17日 今天的交易
  ('cccccccc-0001-0001-0001-000000000014', '2026-01-17 09:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   18, '早餐-包子豆浆', '公司楼下早餐店', false, false, false, 'regular'),

  ('cccccccc-0001-0001-0001-000000000015', '2026-01-17 12:30:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   45, '午餐-日料', '将太无二', false, false, false, 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 账户间划转（包含跨币种）
-- ============================================================================

INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, from_amount, to_amount, description, nature)
VALUES
  -- 人民币转八达通（跨币种）
  ('dddddddd-0001-0001-0001-000000000001', '2025-12-09 10:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   '11111111-1111-1111-1111-111111111104',
   920, 920, 1000, '充值八达通', 'regular'),
  
  -- 从工资卡转到储蓄卡
  ('dddddddd-0001-0001-0001-000000000002', '2025-12-06 12:00:00+08',
   '11111111-1111-1111-1111-111111111102',
   '11111111-1111-1111-1111-111111111101',
   10000, 10000, 10000, '工资转储蓄', 'regular'),
  
  -- 还信用卡
  ('dddddddd-0001-0001-0001-000000000003', '2025-12-20 18:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   '11111111-1111-1111-1111-111111111201',
   5000, 5000, 5000, '还信用卡账单', 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 代付回款（关联交易）
-- ============================================================================

-- 主交易：帮同事代付
INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, description, location, nature)
VALUES
  ('eeeeeeee-0001-0001-0001-000000000001', '2025-12-11 19:00:00+08',
   '11111111-1111-1111-1111-111111111101',
   (SELECT id FROM accounts WHERE name = '餐饮' AND type = 'expense' LIMIT 1),
   300, '团建聚餐帮同事代付', '西贝莜面村', 'regular')
ON CONFLICT (id) DO NOTHING;

-- 关联交易：同事回款
INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, description, linked_transaction_id, link_type, nature)
VALUES
  ('eeeeeeee-0001-0001-0001-000000000002', '2025-12-13 10:00:00+08',
   (SELECT id FROM accounts WHERE name = '代付回款' AND type = 'income' LIMIT 1),
   '11111111-1111-1111-1111-111111111101',
   200, '小王回款', 'eeeeeeee-0001-0001-0001-000000000001', 'reimbursement', 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 备注很长的交易（测试截断）
-- ============================================================================

INSERT INTO transactions (id, date, from_account_id, to_account_id, amount, description, location, nature)
VALUES
  ('ffffffff-0001-0001-0001-000000000001', '2025-12-14 15:00:00+08',
   '11111111-1111-1111-1111-111111111201',
   (SELECT id FROM accounts WHERE name = '购物' AND type = 'expense' LIMIT 1),
   299, '这是一个非常非常长的备注，用于测试备注截断功能是否正常工作。当备注超过30个字符时，应该显示省略号，鼠标悬停时显示完整内容。', '京东自营', 'regular')
ON CONFLICT (id) DO NOTHING;

-- ============================================================================
-- 完成提示
-- ============================================================================
-- 测试数据导入完成！共导入：
-- - 5 笔期初余额
-- - 2 笔收入
-- - 15+ 笔支出
-- - 3 笔账户划转
-- - 2 笔关联交易（代付回款）
-- - 1 笔长备注交易
